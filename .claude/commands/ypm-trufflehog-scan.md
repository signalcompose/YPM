# YPM - TruffleHog Security Scan

YPMで管理している全プロジェクトに対してTruffleHogセキュリティスキャンを実行します。

## 概要

このコマンドは以下を実行します：
1. `python scripts/scan_projects.py`を実行してプロジェクト一覧を取得
2. 各プロジェクトに対してTruffleHogスキャンを実行
3. 検出された問題を見やすく表示

## 実行手順

### STEP 1: TruffleHogのインストール確認

```bash
which trufflehog
```

**trufflehogがインストールされていない場合**:
```
❌ TruffleHogがインストールされていません。

インストール方法:
brew install trufflehog

インストール後、再度このコマンドを実行してください。
```
→ **処理を中断**

### STEP 2: プロジェクトスキャン実行

```bash
python scripts/scan_projects.py
```

スキャン結果のJSONを読み取り、各プロジェクトの`security_scan`情報を確認します。

### STEP 3: スキャン結果の表示

#### 3-1. サマリー表示

```
## 🔒 TruffleHog Security Scan Results

**スキャン実行日時**: 2025-11-11 10:30

**サマリー**:
- 総プロジェクト数: 27個
- スキャン実施: 27個
- 問題検出: 1個
- クリーン: 26個
```

#### 3-2. 問題が検出されたプロジェクト

問題が検出されたプロジェクトを優先表示：

```
---

## ⚠️ セキュリティ問題が検出されたプロジェクト

### godot-mcp
- **パス**: /Users/yamato/Src/MCPServer/godot-mcp
- **ブランチ**: main
- **検出された問題数**: 6個
- **最終更新**: 8ヶ月前
- **推奨アクション**:
  1. プロジェクトディレクトリで詳細確認: `cd /Users/yamato/Src/MCPServer/godot-mcp`
  2. TruffleHog詳細スキャン: `trufflehog git file://. --json | jq`
  3. 検出された機密情報を削除またはgit-filter-repoで履歴クリーン

---
```

#### 3-3. クリーンなプロジェクト（オプション）

```
## ✅ クリーンなプロジェクト（26個）

問題は検出されませんでした：
- Claude-code
- CVI
- InstrVo
- MaxMCP
- ... (他22個)
```

### STEP 4: 次のアクション提案

```
## 📝 推奨される次のアクション

### 問題が検出された場合
1. 各プロジェクトで詳細スキャンを実行
2. 検出された機密情報を確認
3. 必要に応じて履歴クリーンまたはシークレットローテーション

### 定期的なスキャン
- 週次または月次でこのコマンドを実行することを推奨
- 新しいプロジェクトを追加した際にも実行

### 個別プロジェクトのスキャン
各プロジェクト内で `/trufflehog-scan` を使用して個別にスキャン可能
```

---

## 出力例

### 問題なしの場合

```
## 🔒 TruffleHog Security Scan Results

**スキャン実行日時**: 2025-11-11 10:30

**サマリー**:
- 総プロジェクト数: 27個
- スキャン実施: 27個
- 問題検出: 0個
- クリーン: 27個

---

## ✅ すべてのプロジェクトはクリーンです

セキュリティ問題は検出されませんでした。
```

### 問題ありの場合

上記STEP 3の形式で表示

---

## 重要な注意事項

### 1. スキャン時間

- 大量のプロジェクトがある場合、スキャンに時間がかかる可能性があります
- プロジェクトあたり最大30秒のタイムアウト

### 2. 誤検知の可能性

TruffleHogは機密情報のパターンマッチングを行うため、誤検知の可能性があります。
検出された内容を必ず確認してください。

### 3. 履歴スキャン

TruffleHogはGitの履歴全体をスキャンします。
現在のコードに機密情報がなくても、過去のコミットに含まれていれば検出されます。

### 4. プライバシー

スキャン結果にはプロジェクト名やパスが含まれます。
YPMの「プロジェクト情報の外部露出禁止」ポリシーに従い、
この結果をGitコミットやPRに含めないでください。

---

**このコマンドを実行した後、必ず結果をユーザーに表示してください。**
