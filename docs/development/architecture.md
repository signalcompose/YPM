# YPM アーキテクチャドキュメント

**最終更新**: 2025-10-16

---

## 目次

- [概要](#概要)
- [設計原則](#設計原則)
- [ディレクトリ構造](#ディレクトリ構造)
- [コンポーネント](#コンポーネント)
- [データフロー](#データフロー)
- [拡張性](#拡張性)

---

## 概要

YPM (Your Project Manager) は、複数のGitプロジェクトを一元管理するドキュメントベースのツールです。

### アーキテクチャの特徴

1. **ドキュメント駆動**: すべての状態を`PROJECT_STATUS.md`に集約
2. **Git依存**: プロジェクト情報はGit履歴から取得
3. **Claude Code連携**: 更新作業はClaude Codeが実行（将来的にスタンドアロン化）
4. **設定ファイル**: `config.yml`で監視対象を柔軟に設定

---

## 設計原則

### 1. Documentation Driven Development (DDD)

**すべての開発はドキュメントから始まります。**

```
仕様書作成 → 実装 → テスト → ドキュメント更新
```

#### ルール

- 新機能を実装する前に、必ず仕様書を`docs/development/`に作成
- コードとドキュメントが乖離しないよう、変更時は両方を更新
- コントリビューターが迷わないよう、明確で具体的な仕様を書く

#### ドキュメントの階層

| ドキュメント | 対象読者 | 目的 |
|------------|---------|------|
| `README.md` | エンドユーザー | 使い方、セットアップ |
| `CLAUDE.md` | Claude Code | AI向け指示書 |
| `docs/development/*.md` | 開発者 | 設計、仕様、アーキテクチャ |
| `project-bootstrap-prompt.md` | 開発者 | 新規プロジェクト立ち上げガイド |

### 2. シンプルさ優先

- 複雑な依存関係を避ける
- 標準ライブラリを優先（Python標準ライブラリ、YAML、Markdown）
- 外部APIに依存しない

### 3. 読み取り専用原則

**YPMは他のプロジェクトを変更しません。**

- 監視対象プロジェクトは読み取り専用
- Git情報、ドキュメントを読むだけ
- 変更は`PROJECT_STATUS.md`のみ

### 4. 段階的進化

現在のフェーズ：
- **Phase 0**: Claude Code完全依存（完了）
- **Phase 1**: オンボーディングスクリプト（完了）

将来的な拡張の可能性：
- プロジェクト作成支援ツール
- Webベースのダッシュボード
- 自動更新機能（必要性が明確になった場合）

---

## ディレクトリ構造

```
YPM/
├── .claude/
│   ├── settings.json           # Claude Code権限設定（チーム共有）
│   └── settings.local.json     # 個人設定（.gitignore）
├── .serena/                     # Serenaメモリ（.gitignore）
├── docs/
│   ├── INDEX.md                 # ドキュメント索引
│   └── development/             # 開発者向けドキュメント
│       ├── architecture.md      # このファイル
│       └── onboarding-script-spec.md  # オンボーディング仕様書
├── scripts/
│   ├── onboarding.py            # 初回セットアップウィザード
│   ├── update_status.py         # プロジェクト状況更新（将来）
│   └── create_project.py        # プロジェクト作成支援（将来）
├── config.yml                   # 設定ファイル（.gitignore）
├── config.example.yml           # 設定テンプレート
├── project-bootstrap-prompt.md  # 新規プロジェクト立ち上げガイド
├── CLAUDE.md                    # Claude Code向け指示書
├── README.md                    # エンドユーザー向け説明
├── LICENSE                      # MITライセンス
└── .gitignore                   # Git除外設定
```

---

## コンポーネント

### 1. 設定管理

#### `config.yml`
- 監視対象ディレクトリ
- プロジェクト検出パターン
- 分類基準（アクティブ日数等）

#### `config.example.yml`
- 新規ユーザー向けテンプレート

### 2. データ収集（Claude Code / 将来的にスクリプト化）

#### 情報源
- **Git**: `git log`, `git status`, `git branch`
- **ドキュメント**: `CLAUDE.md`, `README.md`, `docs/INDEX.md`

#### 収集データ
- プロジェクト名
- 現在のブランチ
- 最終コミット日時
- 変更ファイル数
- 概要（ドキュメントから抽出）
- 次のタスク（ドキュメントから抽出）

### 3. 状況管理

#### `PROJECT_STATUS.md`
- すべてのプロジェクト情報を集約
- カテゴリ別に分類：
  - 🔥 アクティブ（1週間以内に更新）
  - 💤 休止中（1ヶ月以上更新なし）
  - 📦 Git非管理
- 進捗率、次のタスクを表示

### 4. Claude Code連携

#### `.claude/settings.json`
- Git/GitHub CLI/Serenaの権限設定
- 安全な操作をallow、変更操作をask、破壊的操作をdeny

#### `CLAUDE.md`
- セッション開始時の手順
- 主な機能の説明
- 更新ルール

---

## データフロー

### プロジェクト状況更新フロー

```
1. ユーザー: "プロジェクト状況を更新して"
   ↓
2. Claude Code: config.ymlを読み込み
   ↓
3. Claude Code: 監視対象ディレクトリをスキャン
   ↓
4. 各プロジェクトについて:
   - Git情報を取得（branch, log, status）
   - ドキュメントを読み込み（CLAUDE.md, README.md）
   ↓
5. PROJECT_STATUS.mdを更新
   ↓
6. 変更をコミット・プッシュ（ユーザー承認後）
```

### 初回セットアップフロー（Phase 1実装中）

```
1. ユーザー: YPMをクローン
   ↓
2. Claude Code起動
   ↓
3. Claude Code: config.ymlが存在しない → オンボーディング提案
   ↓
4. ユーザー承認
   ↓
5. Claude Code: `python scripts/onboarding.py` 実行
   ↓
6. スクリプト: 対話的に情報収集
   - 監視対象ディレクトリ
   - プロジェクト検出パターン
   - 分類基準
   ↓
7. スクリプト: config.yml生成
   ↓
8. スクリプト: 初回PROJECT_STATUS.md生成（オプション）
   ↓
9. 完了
```

---

## 拡張性

### 将来の拡張案

YPMは現在、**Phase 1完成状態**です。Claude Code駆動のアプローチが柔軟性と正確性において優れていることが実証されました。

将来的に検討可能な拡張：

- **プロジェクト作成支援ツール**: 新プロジェクトの雛形作成
- **Webダッシュボード**: Next.js等でPROJECT_STATUS.mdを可視化
- **Slack通知**: プロジェクト状況の変更を通知
- **ガントチャート**: 進捗の時系列可視化
- **依存関係グラフ**: プロジェクト間の関連を可視化

**注**: 自動更新スクリプト（cron対応）については、Claude Code駆動アプローチの方が文脈理解とタスク抽出において優れているため、現時点では優先度を下げています。実際の運用で自動化の必要性が明確になった場合に再検討します。

---

## 技術的制約

### 必須要件
- Git（プロジェクト情報の取得）
- Python 3.8+（スクリプト実行）
- Claude Code（現在のフェーズ）

### オプション
- GitHub CLI（gh）: PRやIssue情報の取得
- Serena MCP: コードベース解析（将来）

---

## セキュリティ

### Git管理
- `.serena/`: AI生成メモリ（ローカルのみ）
- `.claude/settings.local.json`: 個人設定（ローカルのみ）
- `config.yml`: 共有（パスは環境依存なので注意）

### 権限設定
- 破壊的Git操作を禁止（push --force, reset --hard等）
- 読み取り操作は自動承認
- 変更操作は確認必須

---

## 貢献ガイドライン

1. **DDD原則を守る**: 実装前に仕様書を書く
2. **シンプルさを保つ**: 複雑な依存を避ける
3. **ドキュメントを更新**: コードと同時に更新
4. **テストする**: 手動テストを実施
5. **PR作成**: 明確な説明とコミットメッセージ

---

**YPMは、シンプルで信頼できるプロジェクト管理ツールです。** 🚀
